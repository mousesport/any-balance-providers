var g_rootrul="https://ib.rencredit.ru",g_baseurl=g_rootrul+"/rencredit.server.portal.app/rest/",g_headers={Accept:"application/json, text/*","Accept-Language":"ru, en","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36",Referer:g_rootrul+"/",Origin:g_rootrul,"X-Requested-With":"XMLHttpRequest"};
function checkAPIResultSimple(b){if(!b)return b;b=getJson(b);if(b.errorResponseMo){var a=b.errorResponseMo.errorMsg;if(a)throw new AnyBalance.Error(a,null,/парол/i.test(a));AnyBalance.trace(JSON.stringify(b));throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}return b}function callAPI(b,a,c){return callAPIEx(b,a,c,null,checkAPIResultSimple)}
function callAPIEx(b,a,c,d,e){b=g_baseurl+b;var h="GET";a&&(b+="?"+createUrlEncodedParams(a));a=c&&c.__paramsAreNotJson;c?h="POST":c="";var f={"X-XSRF-TOKEN":callAPI.data&&callAPI.data.csrfToken};c&&!a&&(f["Content-Type"]="application/json; charset=utf-8");d&&(f=addHeaders(d,f));var g=0;do 0<g&&(AnyBalance.trace("Retrying request: "+g+"/3"),AnyBalance.sleep(1E3)),d=AnyBalance.requestPost(b,"string"==typeof c||a?c:JSON.stringify(c),addHeaders(f),{HTTP_METHOD:h});while(500<=AnyBalance.getLastStatusCode()&&
503>=AnyBalance.getLastStatusCode()&&3>++g);return(e||getJson)(d)}
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");callAPI("public/version");callAPI.data={};callAPI.data.csrfToken=AnyBalance.getCookie("XSRF-TOKEN");var a=callAPI("private/client/info");if(401==AnyBalance.getLastStatusCode()){AnyBalance.trace("Необходим новый логин");a=callAPI("public/auth/login",null,{username:b.login,password:b.password,__paramsAreNotJson:!0});if(a.changePasswordRequired)throw new AnyBalance.Error("Банк требует сменить пароль. Пожалуйста, войдите в интернет банк "+
g_rootrul+" через браузер, смените пароль и введите новый пароль в настройки провайдера",null,!0);a.confirmationType&&"SMS_OTP"===a.confirmationType&&(AnyBalance.trace("Затребован код подтверждения из SMS"),a=AnyBalance.retrieveCode("На телефон "+a.clientInfo.maskedPhoneNumber+" выслан код подтверждения для входа в интернет банк. Пожалуйста, введите его",null,{inputType:"number",time:1E3*a.validityOfOtpInSeconds}),a=callAPI("private/auth/confirm",null,{otp:a,__paramsAreNotJson:!0}))}if(!a.clientInfo){if(b=
a.errorResponseMo&&a.errorResponseMo.errorMsg)throw new AnyBalance.Error(b,null,/парол/i.test(b));AnyBalance.trace(JSON.stringify(a));throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=a.clientInfo;__setLoginSuccessful();return a}
function fetchProductsJson(b){var a={card:{verb:"private/products/cards",name:"карты",firstTimeParams:{forceRequest:"true"}},loan:{verb:"private/products/loans",name:"кредиты"},account:{verb:"private/products/accounts",name:"счета"},deposit:{verb:"private/products/deposits",name:"депозиты"}};if(!a[b])throw new AnyBalance.Error("Неправильный продукт!",null,!0);fetchProductsJson.data||(fetchProductsJson.data={});if(fetchProductsJson.data[b])return fetchProductsJson.data[b];var c=0;do{0<c&&(AnyBalance.trace("Пытаемся получить "+
a[b].name+", попытка "+(c+1)+"/20"),AnyBalance.sleep(2E3));var d=callAPI(a[b].verb,0==c?a[b].firstTimeParams:null)}while(!d.items&&20>++c);return fetchProductsJson.data[b]=d}
function processCards(b){if(AnyBalance.isAvailable("cards")){var a=fetchProductsJson("card");b.cards=[];for(var c=0;c<a.items.length;++c){var d=a.items[c];if("LOY"!=d.cardType.code){var e={__id:d.contractNumber+"_"+d.cardNumber.substr(-4),__name:d.cardNumber,num:d.cardNumber};__shouldProcess("cards",e)&&processCard(d,e);b.cards.push(e)}}}}
function processBonus(b){if(AnyBalance.isAvailable("bonus"))for(var a=fetchProductsJson("card"),c=0;c<a.items.length;++c){var d=a.items[c];"LOY"==d.cardType.code&&getParam(d.availableAmount.amount,b,"bonus")}}
function processCard(b,a){getParam(b.availableAmount.amount,a,"cards.balance");getParam(b.availableAmount.currency.text,a,"cards.currency cards.balance cards.minpay cards.limit cards.own cards.blocked cards.cash".split(" "));getParam(b.availableAmount.currency.code,a,"cards.currencycode");getParam(b.cardType.localizedText,a,"cards.type");getParam(b.cardType.code,a,"cards.type_code");getParam(b.status.localizedText,a,"cards.status");getParam(b.status.code,a,"cards.status_code");getParam(b.lastPayPeriodMinimumPayment.amount,
a,"cards.minpay");getParam(b.creditLimit.amount,a,"cards.limit");getParam(b.ownFundsAmount.amount,a,"cards.own");getParam(b.blockedAmount.amount,a,"cards.blocked");getParam(b.payPeriodDateOfCompletion,a,"cards.minpaytill",null,null,parseDateISO);getParam(b.payPeriodLastDate,a,"cards.payperiodlastdate",null,null,parseDateISO);getParam(b.accountNumber,a,"cards.accnum");getParam(b.contractNumber,a,"cards.contract");getParam(b.productType,a,"cards.type_product");AnyBalance.isAvailable("cards.transactions")&&
processCardsTransactions(b,a)}function processCredits(b){if(AnyBalance.isAvailable("credits")){var a=fetchProductsJson("loan");b.credits=[];for(var c=0;c<a.items.length;++c){var d=a.items[c],e={__id:d.contractNumber,__name:d.contractNumber,num:d.contractNumber};__shouldProcess("credits",e)&&processCredit(d,e);b.credits.push(e)}}}
function processCredit(b,a){getParam(b.balance,a,"credits.balance");getParam(b.loanAmount.currency.text,a,["credits.currency","credits.balance","credits.minpay","credits.limit"]);getParam(b.loanAmount.currency.code,a,"credits.currencycode");getParam(b.loanName,a,"credits.name");getParam(b.nextPaymentAmount,a,"credits.minpay");getParam(b.nextPaymentDate,a,"credits.minpay_till",null,null,parseDateISO);getParam(b.openingDate,a,"credits.date_start",null,null,parseDateISO);getParam(b.status.localizedText,
a,"credits.status");getParam(b.status.code,a,"credits.status_code");getParam(b.accountNumber,a,"credits.accnum");getParam(b.closingDate,a,"credits.date_end",null,null,parseDateISO);getParam(b.loanAmount.amount,a,"credits.limit");getParam(b.term,a,"credits.period");getParam(b.rate,a,"credits.pct");if(AnyBalance.isAvailable("credits.transactions"))try{processCreditsTransactions(b,a)}catch(c){AnyBalance.trace("Не удалось получить транзакции по кредиту: "+c.message)}if(AnyBalance.isAvailable("credits.schedule"))try{processCreditsSchedule(b,
a)}catch(c){AnyBalance.trace("Не удалось получить расписание по кредиту: "+c.message)}}
function processInfo(b,a){a=a.info={};getParam(b.surname+" "+b.name+" "+b.patronymic,a,"info.fio",null,null,capitalFirstLetters);getParam(b.surname,a,"info.name_last",null,null,capitalFirstLetters);getParam(b.patronymic,a,"info.name_patronymic",null,null,capitalFirstLetters);getParam(b.name,a,"info.name",null,null,capitalFirstLetters);getParam(b.maskedHomeNumber,a,"info.hphone");getParam(b.maskedPhoneNumber,a,"info.mphone");getParam(b.maskedOfficePhone,a,"info.wphone");getParam(b.email,a,"info.email")}
;
