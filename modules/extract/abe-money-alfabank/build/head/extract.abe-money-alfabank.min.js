var g_baseurl="https://click.alfabank.ru",g_baseurl_auth="https://private.auth.alfabank.ru/passport/",g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru,en-US;q=0.8,en;q=0.6",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36"},g_some_action='<m xmlns="http://oracle.com/richClient/comm"><k v="type"><s>action</s></k></m>',g_mainHtml,g_csrfToken,
g_pageID;function login(b){AnyBalance.setDefaultCharset("utf-8");var c=AnyBalance.getPreferences();if(g_mainHtml)return g_mainHtml;checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");return processClick(b)}var g_mainHtmlIs20;function isClick20(){isset(g_mainHtmlIs20)||(g_mainHtmlIs20=/\(C2skin\)/.test(g_mainHtml));return g_mainHtmlIs20}
function processClick(b){var c=AnyBalance.getPreferences();AnyBalance.trace("Navigating homepage");var a=AnyBalance.requestGet(g_baseurl_auth+"cerberus-mini-blue/dashboard-blue/username/",g_headers);a=getJsonObject(a,/window.initialState\s*=/);var d=a.passport.authorization.requestId;AnyBalance.trace("state="+JSON.stringify(a)+", requestId="+d);c=JSON.stringify({username:c.login,password:c.password,queryRedirectParams:{acr_values:"username",scope:"click-web",non_authorized_user:"true",client_id:"click-web"},
currentRoute:"/password",captchaKey:""});a=AnyBalance.requestPost(g_baseurl_auth+"cerberus-mini-green/dashboard-green/api/oid/authorize",c,addHeaders({"Content-Type":"application/json"}));d=getJson(a);if(d.error)throw new AnyBalance.Error(d.errors.map(function(g){return g.message}).join("\n"));AnyBalance.trace("login response="+a);if(299<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");if(/username:sms/.test(d.params.acr_values)){AnyBalance.trace("Затребован одноразовый пароль");
c={is_push:!0,previousMultiFactorResponseParams:d.params,queryRedirectParams:{acr_values:"username",scope:"click-web",non_authorized_user:"true",response_type:"code",client_id:"openid click-web"},type:"CARD"};a=AnyBalance.requestPost(g_baseurl_auth+"cerberus-mini-green/dashboard-green/api/oid/reference",JSON.stringify(c),addHeaders({"Content-Type":"application/json"}));AnyBalance.trace("reference -> "+a);d=getJson(a);if(d.error)throw new AnyBalance.Error(d.errors.map(function(g){return g.message}).join("\n"));
a=AnyBalance.retrieveCode("Введите код подтверждения входа из СМС, посланный на "+d.reference.masked_phone,null,{inputType:"number"});c.code=a;c.previousMultiFactorResponseParams.masked_phone=d.reference.masked_phone;c.previousMultiFactorResponseParams.reference=d.reference.reference;a=AnyBalance.requestPost(g_baseurl_auth+"cerberus-mini-green/dashboard-green/api/oid/finishCustomerRegistration",JSON.stringify({credentials:c}),addHeaders({"Content-Type":"application/json"}));AnyBalance.trace("finish -> "+
a);d=getJson(a);if(d.error)throw new AnyBalance.Error(d.errors.map(function(g){return g.message}).join("\n"));}if(!d.redirectUrl)throw new AnyBalance.Error("Не вернули адрес переадресации. Сайт изменен?");a=AnyBalance.requestGet(d.redirectUrl,g_headers);AnyBalance.trace("redirectUrl response="+a);a=clickGoToUrl(a,{isHtml:!0,sessionRequired:!0});AnyBalance.getLastUrl();if(/faces\/main\/changePassword|faces\/routeChangePwd\/changePassword/i.test(a))throw new AnyBalance.Error("Вам необходимо сменить старый пароль. Зайдите в Альфа-Клик через браузер, поменяйте пароль, затем введите новый пароль в настройки провайдера.",
null,!0);if(!/images\/close.png/i.test(a)&&!/&#1042;&#1099;&#1093;&#1086;&#1076;/i.test(a))throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось войти в Альфа-Клик. Сайт изменен?");g_mainHtml=a;if(isClick20())AnyBalance.trace("Определен Альфа-Клик 2.0"),turnOffLoginOtp();else if(AnyBalance.trace("Определен Альфа-Клик 1.0"),!b||!b.allowClick10)throw new AnyBalance.Error("К сожалению, Альфа-Клик 1.0 не поддерживается. Зайдите в Альфа-Клик через браузер и переключите ваш Альфа-Клик на версию 2.0");
__setLoginSuccessful();return a}
function clickGoToUrl(b,c){c||(c={});b=c.isHtml?b:AnyBalance.requestGet(b,g_headers);var a=getParam(b,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Не удаётся найти параметр для входа: _afrLoop. Сайт изменен?");b=getParam(b,null,null,/var\s+sess\s*=\s*"([^"]*)/i,replaceSlashes);if(c.sessionRequired&&!b)throw new AnyBalance.Error("Не удаётся найти параметр для входа: sess. Сайт изменен?");b=AnyBalance.requestGet(g_baseurl+"/ALFAIBSR/"+b+"?_afrLoop="+a+"&_afrWindowMode=0&_afrWindowId=null",
g_headers);c=getParam(b,null,null,/<div[^>]+id="ct"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);AnyBalance.trace("CSRF token found: "+c);g_csrfToken=c;c=getParam(b,null,null,/location\.href\s*=\s*'(\/ALFA[^']*)/,replaceSlashes);b=AnyBalance.requestGet(g_baseurl+c,g_headers);a=getParam(b,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!a)throw new AnyBalance.Error("Не удаётся найти очередной параметр для входа: _afrLoop. Сайт изменен?");return b=AnyBalance.requestGet(g_baseurl+c+"&_afrLoop="+a+"&_afrWindowMode=0&_afrWindowId=null",
g_headers)}function paramToCookie(b){var c=AnyBalance.getLastUrl().match(new RegExp("[?&]"+b+"=([^&]*)"));c&&1<c.length&&AnyBalance.setCookie(g_baseurl.replace(/https?:\/\//i,""),b,c[1],{path:"/ALFAIBSR"})}
function clickFollowUrl(b){for(var c=5;--c;){var a=AnyBalance.requestGet(b,g_headers),d=getParam(a,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!d)break;b=AnyBalance.getLastUrl();a=AnyBalance.requestGet(b+"&_afrLoop="+d+"&_afrWindowMode=0&_afrWindowId=null",g_headers);if(b=getParam(a,null,null,/<div[^>]+id="ct"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))AnyBalance.trace("CSRF token found: "+b),g_csrfToken=b;b=sumParam(a,null,null,/paramToCookie\s*\(\s*['"]([^'"]*)/ig);for(d=0;d<b.length;++d)paramToCookie(b[d]);
b=getParam(a,null,null,/location\.href\s*=\s*'(\/ALFA[^']*)/,replaceSlashes);if(!b)break;b=g_baseurl+b}if(0==c)throw AnyBalance.trace("Не удалось перейти на ссылку: "+a),new AnyBalance.Error("Не удалось перейти на ссылку");return a}
function processCards2(b,c){if(AnyBalance.isAvailable("cards")){AnyBalance.trace("Получаем информацию о картах");b=getMainPageOrModule2(b,"card");var a=getElements(b,/<table[^>]+card-list/ig);if(!a.length)if(/Удобство пластиковых карт:/i.test(b))AnyBalance.trace("Нет ни одной карты");else{AnyBalance.trace("Не удалось найти карты\n"+b);return}c.cards=[];AnyBalance.trace("Найдено карт: "+a.length);for(var d=0;d<a.length;++d){var g=a[d],e=getParam(g,/\*{4}([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),f=getParam(g,
/<a[^>]+style="[^"]*display:\s*inline;[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces);e={__id:e,__name:f+" ("+e+")"};__shouldProcess("cards",e)&&processCard2(b,g,e);c.cards.push(e)}}}
function processCard2(b,c,a){c=getParam(c,/\*{4}[\s\S]*?<a[^>]+id="([^"]*)/i,replaceHtmlEntities);b=getNextPage(b,c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]);getParam(b,a,"cards.balance",/&#1041;&#1072;&#1083;&#1072;&#1085;&#1089; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"cards.currency cards.balance cards.topay cards.debt cards.minpay cards.penalty cards.late cards.overdraft cards.limit".split(" "),
/&#1041;&#1072;&#1083;&#1072;&#1085;&#1089; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(b,a,"cards.till",/&#1057;&#1088;&#1086;&#1082; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(b,a,"cards.num",/&#1053;&#1086;&#1084;&#1077;&#1088;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,["cards.type","cards.credit"],
/&#1058;&#1080;&#1087;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("cards.credit")&&(a.credit=/кредитн/i.test(""+a.type));getParam(b,a,"cards.acctype",/&#1053;&#1072;&#1079;&#1074;&#1072;&#1085;&#1080;; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.holder",/&#1056;&#1072;&#1076;&#1099; &#1042;&#1072;&#1089; &#1074;&#1080;&#1076;&#1077;&#1090;&#1100;,([^<(]*)/i,replaceTagsAndSpaces);getParam(b,
a,"cards.status",/&#1057;&#1090;&#1072;&#1090;&#1091;&#1089;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.accnum",/&#1053;&#1086;&#1084;&#1077;&#1088; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("cards.transactions")&&processCardTransactions(b,a)}
function processAccounts2(b,c){if(AnyBalance.isAvailable("accounts")){AnyBalance.trace("Получаем информацию о счетах");b=getMainPageOrModule2(b,"acc");var a=getElements(b,/<table[^>]+class="accounts_table"[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено счетов: "+a.length);c.accounts=[];for(var d=0;d<a.length;d++){var g=a[d],e=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);
e={__id:e,__name:f+" ("+e.substr(-4)+")"};__shouldProcess("accounts",e)&&processAccount2(b,g,e);c.accounts.push(e)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти ни одного счета")}}function n2(b){return 10>b?"0"+b:""+b}
function processAccount2(b,c,a){c=getElements(c,/<td[^>]*>/ig);getParam(c[4],a,["accounts.currency","accounts.balance"],null,replaceTagsAndSpaces);getParam(c[3],a,"accounts.balance",null,replaceTagsAndSpaces,parseBalance);getParam(c[0],a,"accounts.type",null,replaceTagsAndSpaces);getParam(c[1],a,"accounts.num",null,replaceTagsAndSpaces);AnyBalance.isAvailable("accounts.date_start","accounts.transactions","accounts.own","accounts.limit","accounts.blocked")&&(c=getParam(c[0],null,null,/<a[^>]+id="([^"]*)/i,
replaceTagsAndSpaces),b=getNextPage(b,c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]),getParam(b,a,"accounts.own",/&#1058;&#1077;&#1082;&#1091;&#1097;&#1080;&#1081; &#1073;&#1072;&#1083;&#1072;&#1085;&#1089;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(b,a,"accounts.limit",/&#1054;&#1074;&#1077;&#1088;&#1076;&#1088;&#1072;&#1092;&#1090;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(b,
a,"accounts.date_start",/&#1044;&#1072;&#1090;&#1072; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103; &#1089;&#1095;&#1105;&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(b,a,"accounts.blocked",/&#1047;&#1072;&#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1086; &#1089;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),AnyBalance.isAvailable("accounts.transactions")&&
processAccountTransactions(b,a))}function createParams(b,c){for(var a={},d=0;d<b.length;++d)b[d]&&(a[b[d][0].replace(/%EVENT%/g,c)]=b[d][1].replace(/%EVENT%/g,c));return a}
function getMainPageOrModule2(b,c){var a={card:"pt1:menu:ATP2_r1:0:i1:1:cl2",acc:"pt1:menu:ATP2_r1:0:i1:0:cl2",dep:"pt1:menu:ATP2_r1:0:i1:3:cl2",crd:"pt1:menu:ATP2_r1:0:i1:2:cl2",providers:"pt1:menu:ATP2_r1:0:i1:6:cl2"};return getNextPage(b,a[c]?a[c]:c,[["oracle.adf.view.rich.RENDER","pt1:menu:ATP2_r1"],["oracle.adf.view.rich.DELTAS","{pt1:menu:ATP2_r1:0:i1:3:p1={_shown=}}"],["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PROCESS","pt1:menu:ATP2_r1"]])}
function parseScriptTag(b){var c=getParam(b,null,null,/^\s*<!\[CDATA\[([\s\S]*)?\]\]>\s*$/i);return c?c:html_entity_decode(b)}
function getNextPage(b,c,a,d){var g=getParam(b,null,null,/<form[^>]*name="f1"[^>]*>([\s\S]*?)<\/form>/i),e=getParam(b,null,null,/<form[^>]*name="f1"[^>]*action="(\/ALFAIBSR[^"]*)/i,replaceHtmlEntities);if(!e)throw new AnyBalance.Error("Не удаётся найти форму ввода команды. Сайт изменен?");d||(d={});g=createFormParams(g,function(m,n,l,k){if(!/::input$/.test(l))return d.paramsFunc&&(k=d.paramsFunc(m,n,l,k)),k},!0);c=createParams(joinArrays(g,a),c);e=AnyBalance.requestPost(g_baseurl+e,c,addHeaders(d.headers||
{"Adf-Ads-Page-Id":g_pageID,"Adf-Rich-Message":"true","Csrf-Token":g_csrfToken}),{options:d.requestOptions});if(!/<\?Adf-Rich-Response-Type\s*\?>/i.test(e))return e;if(d.withScripts){var f=create_aggregate_join("\n");f=sumParam(e,null,null,/<script>([\s\S]*?)<\/script>/ig,null,parseScriptTag,f)}c=sumParam(e,null,null,/<fragment>\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*<\/fragment>/ig);for(a=0;a<c.length;a++){g=c[a];var h=getParam(g,null,null,/^\s*<[^>]+[\s"]id="([^"]*)/i,replaceHtmlEntities);if("afr::DocWrapper"==
h){b=g;break}h=getElement(b,new RegExp('<\\w+[^>]*[\\s"]id="'+h+'"[^>]*>',"i"));b=b.replace(h,g)}/<div[^>]+id="pt1:menu:ATP2_r1"[^>]*>/i.test(b)&&(g_mainHtml=b);e=getParam(e,null,null,/AdfPage.PAGE._setPageId\('([^']*)/i,replaceSlashes);isset(e)&&(g_pageID=e);return d.withScripts?{html:b,scripts:f}:b}
function processCredits2(b,c){if(AnyBalance.isAvailable("credits")){AnyBalance.trace("Получаем информацию о кредитах");b=getMainPageOrModule2(b,"crd");var a=getElements(b,/<a[^>]+id="[^"]*::disAcr"[^>]*>/ig);if(a){AnyBalance.trace("Кредитов в системе: "+a.length);c.credits=[];for(var d=0;d<a.length;++d){var g=b;if(0<d){AnyBalance.trace("Запрос кредита №"+(d+1));var e=getParam(a[d],null,null,/<a[^>]+id="([^"]*)::disAcr"/i,replaceHtmlEntities);g=getNextPage(b,e,[["event","%EVENT%"],["event.%EVENT%",
'<m xmlns="http://oracle.com/richClient/comm"><k v="expand"><b>1</b></k><k v="type"><s>disclosure</s></k></m>'],["oracle.adf.view.rich.PROCESS","pt1:r12:0:pt2"]])}e=getParam(g,null,null,/<a[^>]+id="([^"]*)"[^>]*>&#1055;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1072;&#1103; &#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;/i);if(!e)throw AnyBalance.trace(g),new AnyBalance.Error("Не удаётся найти ссылку на подробную информацию о кредите!",{investigate:!0});AnyBalance.trace("Запрос данных по кредиту №"+
(d+1));g=getNextPage(g,e,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]);e=getParam(g,null,null,/\d{20}/i);var f=getParam(a[d],null,null,null,replaceTagsAndSpaces);e={__id:e,__name:f};__shouldProcess("credits",e)&&processCredit2(g,e);c.credits.push(e)}}else AnyBalance.trace("Не удаётся найти ни одного кредита!")}}
function parseNDay(b){var c=getParam(b,null,null,/(\d+)[^<]*число/i,null,parseBalance);if(isset(c)){var a=new Date;c=new Date(a.getFullYear(),a.getMonth()+(a.getDate()>c?1:0),c);AnyBalance.trace("Parsed date "+c+" from "+b);return c.getTime()}}
function processCredit2(b,c){for(var a=getElements(b,/<table[^>]+pglCreditDetails(?:Label)?List[^>]*/ig),d=!1,g=0;g<a.length;g++){var e=a[g],f=getElements(e,/<td[^>]*>/ig);if(!(2>f.length)){var h=getParam(f[f.length-2],null,null,null,replaceTagsAndSpaces);f=getParam(f[f.length-1],null,null,null,replaceTagsAndSpaces);/Для полного погашения|Доступно для трат/i.test(h)?(getParam(f,c,"credits.balance",null,null,parseBalance),getParam(f,c,["credits.currency","credits.balance"],null,null,parseCurrency)):
/Собственных средств/i.test(h)?getParam(f,c,"credits.own",null,null,parseBalance):/Задолженность|Остаток задолженности|Для полного погашения/i.test(h)?getParam(f,c,"credits.debt",null,null,parseBalance):/сумма основного долга/i.test(h)&&!d?getParam(f,c,"credits.debt_main",null,null,parseBalance):/сумма начисленных процентов/i.test(h)&&!d?getParam(f,c,"credits.debt_pct",null,null,parseBalance):/Процентная ставка/i.test(h)?getParam(f,c,"credits.pct",null,null,parseBalance):/Установленный лимит|Начальная сумма кредита/i.test(h)?
getParam(f,c,"credits.limit",null,null,parseBalance):/Неподтверждённые операции/i.test(h)?getParam(f,c,"credits.blocked",null,null,parseBalance):/Льготный период/i.test(h)?getParam(f,c,"credits.gracepay",null,null,parseBalance):/Дата начала льготного периода/i.test(h)?getParam(f,c,"credits.grace_start",null,null,parseDateWord):/Дата окончания льготного периода/i.test(h)?getParam(f,c,"credits.gracepay_till",null,null,parseDateWord):/дата платежа|Оплатить до/i.test(h)?getParam(f,c,"credits.pay_till",
null,null,parseDateWord):/Ближайший плат[её]ж|Минимальный плат[её]ж|Ежемесячный плат[её]ж/i.test(h)?(d=!0,getParam(f,c,["credits.minpay","credits.minpay_left"],null,null,parseBalance)):"основной долг"==h&&d?getParam(f,c,"credits.minpay_main",null,null,parseBalance):"проценты"==h&&d?getParam(f,c,"credits.minpay_pct",null,null,parseBalance):/Дата выдачи/i.test(h)?getParam(f,c,"credits.date_start",null,null,parseDateWord):/Срок кредита/i.test(h)?getParam(f,c,"credits.period"):/День платежа/i.test(h)?
(getParam(f,c,"credits.payment_day"),getParam(f,c,"credits.minpay_till",null,null,parseNDay)):/Уже внесено/i.test(h)?getParam(f,c,["credits.minpay_paid","credits.minpay_left"],null,null,parseBalance):AnyBalance.trace("Неизвестный параметр: "+h+": "+f+"\n"+e)}}getParam(b,c,"credits.minpay_left",/<span[^>]+ACCreditsLargeHeaderFont[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("credits.transactions")&&processCreditTransactions(b,c)}function processInfo2(b,c){}
function processDeposits2(b,c){if(AnyBalance.isAvailable("deposits")){AnyBalance.trace("Получаем информацию о депозитах");b=getMainPageOrModule2(b,"dep");var a=sumParam(b,null,null,/<table[^>]+(?:[\s\S](?!<\/?table))*?>\d{20}<[\s\S]*?<\/table>/ig);if(!a.length)if(/Депозиты в банке, как и накопительные/i.test(b))AnyBalance.trace("Нет ни одного депозита");else{AnyBalance.trace("Не удалось найти депозиты: "+b);return}AnyBalance.trace("Найдено депозитов: "+a.length);c.deposits=[];for(var d=0;d<a.length;d++){var g=
a[d],e=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);e={__id:f,__name:e+" "+h+" ("+f.substr(-4)+")"};h||AnyBalance.trace("Не удалось получить баланс и валюту для депозита "+e.__name+": "+g);__shouldProcess("deposits",e)&&processDeposit2(b,g,e);c.deposits.push(e)}}}
function parseBool(b){return/Не предусмотрена/i.test(b)?!1:/Да/i.test(b)}
function processDeposit2(b,c,a){AnyBalance.trace("Получаем депозит "+a.__name);getParam(c,a,"deposits.acctype",/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,a,"deposits.accnum",/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,a,"deposits.balance",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"deposits.currency",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,
a,"deposits.till",/>\s*&#1044;&#1086; (\d+[^>]*<)/i,replaceTagsAndSpaces,parseDateWord);if(AnyBalance.isAvailable("deposits.expressnum","deposits.balance_start","deposits.pct_sum","deposits.date_start","deposits.period","deposits.pct","deposits.pct_cap","deposits.topup","deposits.topup_till","deposits.topup_min","deposits.withdraw","deposits.balance_min","deposits.pct_conditions","deposits.prolongate")){c=getParam(c,null,null,/<a[^>]+id="([^"]*)"[^>]*p_AFTextOnly/i,replaceHtmlEntities);b=getNextPage(b,
c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]);c=getElements(b,/<tr[^>]+id="pt\d+:plam\d+[^>]*>/ig);for(var d=0;d<c.length;d++){var g=c[d],e=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);/Экспресс-счёт/i.test(e)?getParam(f,a,"deposits.expressnum"):/Сумма на дату открытия/i.test(e)?getParam(f,a,"deposits.balance_start",
null,null,parseBalance):/Сумма выплаченных процентов/i.test(e)?getParam(f,a,"deposits.pct_sum",null,null,parseBalance):/Дата открытия/i.test(e)?getParam(f,a,"deposits.date_start",null,null,parseDateWord):/Срок депозита/i.test(e)?getParam(f,a,"deposits.period",null,null,parseBalance):/Процентная ставка$/i.test(e)?getParam(f,a,"deposits.pct",null,null,parseBalance):/Процентная ставка с учетом капитализации/i.test(e)?getParam(f,a,"deposits.pct_cap",null,null,parseBalance):/Возможность пополнения/i.test(e)?
getParam(f,a,"deposits.topup",null,null,parseBool):/Крайний срок пополнения/i.test(e)?getParam(f,a,"deposits.topup_till",null,null,parseDateWord):/Минимальная сумма пополнения/i.test(e)?getParam(f,a,"deposits.topup_min",null,null,parseBalance):/Возможность частичного снятия/i.test(e)?getParam(f,a,"deposits.withdraw",null,null,parseBool):/Сумма неснижаемого остатка/i.test(e)?getParam(f,a,"deposits.balance_min",null,null,parseBalance):/Условие начисления процентов/i.test(e)?getParam(f,a,"deposits.pct_conditions"):
/Автоматическая пролонгация/i.test(e)?getParam(f,a,"deposits.prolongate",null,null,parseBool):/Текущий баланс|Депозитный счёт|Дата окончания/i.test(e)||AnyBalance.trace("Неизвестный параметр "+e+": "+f+"\n"+g)}}AnyBalance.isAvailable("deposits.transactions")&&processDepositTransactions(b,a)}
function turnOffLoginOtp(){try{var b=AnyBalance.requestGet("https://settings.alfabank.ru/settings/logins-passwords",g_headers),c=AnyBalance.getLastUrl();b=AnyBalance.requestGet("https://settings.alfabank.ru/settings/api/load?_="+(new Date).getTime(),addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"}));for(var a=getJson(b),d=0;d<a.length;++d)if(a[d].channels){a=a[d];break}var g=!1;for(d=0;a.channels&&d<a.channels.length;++d){var e=a.channels[d];if("C2"===e.id){g=!0;e.hasAdditionalLoginPassword?
(AnyBalance.trace("В настройках требуется подтверждение входа по SMS, отключаем..."),b=AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/entry-method/save",{entryMethod:"WITHOUT_SMS"},addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),a=getJson(b),AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/pipe-operation",{"authMethod[methodId]":a.authMethods[0].methodId,"authMethod[passwordSize]":a.authMethods[0].passwordSize||"",operationId:a.references[0],type:"GENERATE_PASSWORD"},
addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/pipe-operation",{operationId:a.references[0],isBundle:"false","references[]":a.references.join(","),password:"",type:"CONFIRM"},addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),AnyBalance.trace("Может быть, отключили...")):AnyBalance.trace("Подтверждение входа по SMS не требуется...");break}}g||AnyBalance.trace("Не удалось найти настройку SMS при входе")}catch(f){AnyBalance.trace("Ошибка отключения OTP при входе: "+
f.message)}};
