'use strict';class RuCaptcha{constructor(a){this.key=a;this.baseurl="https://rucaptcha.com/"}async solveReCaptcha2(a,{url:b,userAgent:c}){a=await this.sendToRecognition({method:"userrecaptcha",googlekey:a,pageurl:b,userAgent:c});return await this.waitForResult(a)}async solveFunCaptcha(a,{url:b,userAgent:c,surl:d}){a=await this.sendToRecognition({method:"funcaptcha",publickey:a,pageurl:b,surl:d,userAgent:c});return await this.waitForResult(a)}async sendToRecognition(a){let b=1,c;do await AnyBalance.trace("Отправка капчи на распознавание, попытка "+
b),1<b&&await AnyBalance.sleep(5E3),c=await AnyBalance.requestPost(this.baseurl+"in.php",joinObjects({key:this.key,soft_id:"1351"},a)),await AnyBalance.trace("Статус принятия капчи: "+c.getText());while(/ERROR_NO_SLOT_AVAILABLE/.test(c.getText())&&5>b++);a=getParam(c.getText(),/^OK\|(\S+)/);if(!a)throw new AnyBalance.Error("Не удалось отправить капчу на распознавание! "+c.getText());return a}async waitForResult(a){let b,c=1;do{try{b=await AnyBalance.requestGet(this.baseurl+"res.php?"+createUrlEncodedParams({key:this.key,
action:"get",id:a}));var d=b.getLastStatusCode();if(400<=d)throw new AnyBalance.Error(d+" "+b.getLastStatusString());if(!/^CAPCHA_NOT_READY/.test(b.getText()))break}catch(e){if(await AnyBalance.trace("Ошибка проверки статуса капчи (попытка "+c+"): "+e.message),5<=c++)throw e;}await AnyBalance.sleep(5E3)}while(1);a=getParam(b.getText(),/^OK\|([\s\S]*\S)/);if(!a)throw new AnyBalance.Error("Не удалось распознать капчу: "+b.getText());return a}};
