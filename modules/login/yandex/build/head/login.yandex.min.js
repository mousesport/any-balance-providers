function apiPost(a,e,b,f){a=AnyBalance.requestPost(a,{csrf_token:csrf,track_id:track_id},addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:baseurl,Referer:referer}));json=getJson(a);if("ok"!==json.status)throw AnyBalance.trace(a),a=json.errors.join("; "),new AnyBalance.Error("Пароль не принят: "+a,null,/not_matched/.test(a));}
function loginYandex(a,e,b,f,g){function h(d,k,n,m){d=AnyBalance.requestPost("https://passport.yandex.ru/"+d,k,addHeaders({"X-Requested-With":"XMLHttpRequest",Origin:"https://passport.yandex.ru",Referer:l}));k=getJson(d);if("ok"!==k.status)throw AnyBalance.trace(d),d=k.errors.join("; "),new AnyBalance.Error(n+": "+d,null,m&&m.test(d));return k}var c={};g&&(c.origin=g);f&&(c.retpath=f);var l="https://passport.yandex.ru/auth/?"+createUrlEncodedParams(c);b||(b=AnyBalance.requestGet(l,g_headers));c=getParam(b,
/<input[^>]+name="csrf_token"[^>]*value="([^"]*)/i,replaceHtmlEntities);var p=getParam(b,/process_uuid=([^&"]*)/i,replaceHtmlEntities,decodeURIComponent);json=h("registration-validations/auth/multi_step/start",{csrf_token:c,login:a,process_uuid:p,retpath:f,origin:g},"Вход не может быть выполнен. Сайт изменен?",/userNotFound|prohibitedsymbols/);if(!json.can_authorize)throw AnyBalance.trace(b),new AnyBalance.Error("Этот логин не может быть авторизован (неверный логин)",null,!0);a=json.track_id;b=h("registration-validations/auth/multi_step/commit_password",
{csrf_token:c,track_id:a,password:e,retpath:f},"Пароль не принят",/not_matched/);if("auth_challenge"===json.state){AnyBalance.trace("Потребовалась дополнительная проверка входа");b=h("registration-validations/auth/challenge/submit",{csrf_token:c,track_id:a},"Запрос проверки: "+error);e=json.challenge.challengeType;if("phone_confirmation"===e){AnyBalance.trace("Требуется подтверждение по телефону");g=json.challenge.phoneId;b=h("registration-validations/auth/validate_phone_by_id",{csrf_token:c,track_id:a,
phoneId:g},"Запрос на валидацию не принят");if(!json.valid_for_flash_call)throw AnyBalance.trace(b),new AnyBalance.Error("Требуемое подтверждение не поддерживается");b=h("registration-validations/phone-confirm-code-submit",{csrf_token:c,track_id:a,phone_id:g,confirm_method:"by_flash_call",isCodeWithFormat:!0},"Запрос на посылку кода не принят");b=AnyBalance.retrieveCode("Пожалуйста, введите последние "+json.code_length+" цифры номер, который вам сейчас позвонит на ваш номер "+json.number.masked_international);
b=h("registration-validations/phone-confirm-code",{csrf_token:c,track_id:a,code:b},"Подтверждение кода не удалось")}else throw AnyBalance.trace(b),new AnyBalance.Error("Challenge не поддерживется: "+e);b=AnyBalance.requestPost("https://passport.yandex.ru/registration-validations/auth/challenge/commit",{csrf_token:c,track_id:a,challenge:e},"Ошибка подтверждения")}return b=AnyBalance.requestGet("https://passport.yandex.ru/auth/finish/?"+createUrlEncodedParams({track_id:a,retpath:f}),addHeaders({Referer:l}))}
;
