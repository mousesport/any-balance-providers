function Cloudflare(k){function r(a){a=sumParam(a,/(\w+\s*=\s*(["'])[^'"]*\2)/g);for(var c={},b=0;b<a.length;++b){var d=/(\w+)\s*=\s*["']([^'"]*)/.exec(a[b]);c[d[1]]=html_entity_decode(d[2])}return c}function n(a,c,b){function d(e,f){if(!/^https?:/i.test(f)){var t=k;/^\//.test(f)&&(t=p(e));f=(t+"/"+f).replace(/([^:])\/{2,}/g,"$1/")}return f}var g=b||[],u;b={set src(e){/img/i.test(a)?x.push(p()+e):h.trace("Can not set src of "+a+" to "+e)},set innerHTML(e){var f=/^<(\w+)\s*([^>]*)>([^<]*)<\/\1>$/.exec(e);
if(!f)throw new h.Error("Creation of too complex innerHTML is not implemented: "+e);e=r(f[2]);g.push(new n(a,e))},get firstChild(){return g[0]},set href(e){u=d(k,e)},get href(){return u},submit:function(){for(var e=[],f=0;f<g.length;++f)e.push([g[f].name,g[f].value]);f=this.method||"get";this.action=this.action.replace("undefined","");/get/i.test(f)?m._lastHtml=h.requestGet(d(k,this.action)+"?"+createUrlEncodedParams(e),v):m._lastHtml=h.requestPost(d(k,this.action),e,v)}};for(var w in c)b[w]=c[w];
return b}function p(a){return getParam(a||k,/^(https?:\/\/[^\/]*)/i)}var h=AnyBalance,v=addHeaders(g_headers,{Referer:k}),x=[],q={},l={location:function(){return{href:k,reload:function(){if(l.onunload)l.onunload()}}}(),document:m},m={get cookie(){var a=h.getCookies(),c=getParam(k,/^https?:\/\/([^\/]*)/i);return a.reduce(function(b,d){endsWith(d.domain,c)&&(b&&(b+=";"),b+=d.name+"="+d.value);return b},"")},set cookie(a){var c=getParam(a,/\bpath=([^;]*)/i),b=getParam(a,/\bdomain=([^;]*)/i)||getParam(k,
/^https?:\/\/([^\/]*)/i);a=getParam(a,/^[^;]*/).match(/([^=]*)=(.*)/);h.setCookie(b,a[1],a[2],{path:c})},createElement:function(a){return n(a)},getElementById:function(a){return q[a]},window:l};l.parent=l;9<=h.getLevel()&&h.restoreCookies();return{document:m,window:l,isCloudflared:function(a){return/<input[^>]+name="jschl_vc"[^>]*value="([^"]*)/i.test(a)||/<form[^>]+chk_captcha/i.test(a)},executeScript:function(a){if(/<form[^>]+chk_captcha/i.test(a)){var c=a;AnyBalance.trace("Cloudflare потребовало reCaptcha");
a=getParam(c,/data-ray="([^"]*)/i,replaceHtmlEntities);var b=getParam(c,/data-sitekey="([^"]*)/i,replaceHtmlEntities);if(!a||!b)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось найти параметры Cloudflare для ввода капчи");c=solveRecaptcha("Вы заходите из небезопасного расположения. Cloudflare требует доказать, что вы не робот.","https://cloudflare.com/",b);b=p();a=c=AnyBalance.requestGet(b+"/cdn-cgi/l/chk_captcha?"+createUrlEncodedParams({id:a,"g-recaptcha-response":c}),addHeaders({Referer:k}))}else{c=
a;AnyBalance.trace("Пытаемся пройти автоматизированную проверку браузера Cloudflare");a=[l,m,l.location,l];b=sumParam(getElement(c,/<form[^>]+challenge-form/i),/<input[^>]*>/ig);for(var d=[],g=0;g<b.length;++g)d.push(new n("input",r(b[g])));q={"challenge-form":new n("form",{action:"/cdn-cgi/l/chk_jschl"},d)};for(g=0;g<d.length;++g)d[g].id&&(q[d[g].id]=d[g]);b=/setTimeout\(function\(\)\{([\s\S]*?)\},\s*(\d+)\)/.exec(c);if(!b)throw h.trace(c),new h.Error("Не удалось найти скрипт Cloudflare для выполнения");
c=b[1];h.sleep(+b[2]);safeEval(c,"window,document,location,parent",a);a=m._lastHtml}9<=h.getLevel()&&(h.saveCookies(),h.saveData());return a}}};
