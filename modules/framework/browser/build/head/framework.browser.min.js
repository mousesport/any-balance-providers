var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(e){return e.raw=e};$jscomp.createTemplateTagFirstArgWithRaw=function(e,a){e.raw=a;return e};
var BrowserAPI=function(){var e=function(a){this.options=a;this.headerMatchCounts=[]};e.prototype.requestAPI=function(a,b){var c=this.options.debug?"http://localhost:4024":"http://browser.anybalance.ru:4024";b=b?AnyBalance.requestPost(c+"/"+a,JSON.stringify(b),{"Content-Type":"application/json"}):AnyBalance.requestGet(c+"/"+a+(0<=a.indexOf("?")?"&":"?")+"_="+ +new Date);c=JSON.parse(b);if("ok"!==c.status)throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка browser api ("+a+"): "+c.message);return c};
e.prototype.open=function(a){var b=this.requestAPI("base/open",{userAgent:this.options.userAgent,url:a,rules:this.options.rules});AnyBalance.trace("Opening page "+a+": "+b.page);return b};e.prototype.waitForLoad=function(a){var b=0;do{++b;AnyBalance.sleep(3E3);var c=this.requestAPI("base/status?page="+a);AnyBalance.trace("Loading status of page "+a+": "+c.loadStatus+" (попытка "+b+")");if(c.pendingRequests&&0<c.pendingRequests.length)for(var p=0;p<c.pendingRequests.length;++p){var f=c.pendingRequests[p],
n=[],q;for(q in f.headers)for(var k=f.headers[q].split("\n"),d=0;d<k.length;++d)n.push([q,k[d]]);k={};if(this.options.additionalRequestHeaders)for(d=0;d<this.options.additionalRequestHeaders.length;++d){var g=this.options.additionalRequestHeaders[d];if(!g.url||g.url.test(f.url)){var l=this.headerMatchCounts;if(g.maxCount||(l[d]||0)<g.maxCount){k=g.headers||{};g.maxCount&&(l[d]=(l[d]||0)+1);break}}}n=AnyBalance.requestPost(f.url,f.body,addHeaders(n,k),{HTTP_METHOD:f.method});k=AnyBalance.getLastResponseParameters();
d={};g=void 0;for(l=0;l<k.headers.length;++l){var m=k.headers[l],h=m[0].toLowerCase();0<=["transfer-encoding","content-encoding"].indexOf(h)||("content-length"===h&&(m[1]=""+unescape(encodeURIComponent(n||"")).length),void 0===d[h]?d[h]=m[1]:Array.isArray(d[h])?d[h].push(m[1]):d[h]+=[m[1]],"content-type"===h&&(g=m[1]))}f={id:f.id,page:a,r:{status:AnyBalance.getLastStatusCode(),headers:d,contentType:g,body:n}};this.requestAPI("base/response",f)}else if("load"===c.loadStatus)break}while(15>b);if("load"!==
c.loadStatus)throw new AnyBalance.Error("Waiting for page "+a+" loading timeout!");};e.prototype.content=function(a){return this.requestAPI("base/content?page="+a)};e.prototype.cookies=function(a,b){b&&(Array.isArray(b)||(b=[b]));return this.requestAPI("base/cookies",{page:a,urls:b})};e.prototype.close=function(a){return this.requestAPI("base/close",{page:a})};e.useCookies=function(a){for(var b=0;b<a.length;++b){var c=a[b];AnyBalance.setCookie(c.domain,c.name,c.value,c)}};return e}();
